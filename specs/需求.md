*如你对票池需求有任何建议，请在下面任何一个链接提供您宝贵的反馈：*

1. http://12306ng.org/thread-1682-1-1.html
2. https://github.com/12306NgPM/12306ngpm/issues
3. http://sbbs.me/post/509681fb08158e1b10000037

#服务管理
----

**向服务网关注册和注销服务**

**服务网关收集票池服务的性能计数器以便响应健康管理**

1. 票池当天接受查询的总量 - 一个长整数
2. 票池当天接受未支付订单的总数 - 一个长整数
3. 票池当天已支付订单的总数 - 一个长整数
4. 票池内部累计内存分配请求的总次数 - 一个长整数
5. 票池累计请求分配内存的总量 - 一个长整数
6. 十大经常查询的始发站和到达站 - 一个固定长度的数组
7. 余票查询费时最长时间的始发站和到达站的查询 - 一个固定结构
8. 余票查询平均时间 - 一个时间范围结构
9. 截止目前一天内接受的最大查询量 - 一个长整数

10. 截止目前一天内接受的最小查询量 - 一个长整数

11. 截止目前一天内接受未支付订单的最大总数 - 一个长整数

12. 截止目前一天内接受未支付订单的最小总数 - 一个长整数

13. 截止目前一天内接受已支付订单的最大总数 - 一个长整数

14. 截止目前一天内接受已支付订单的最小总数 - 一个长整数

15. 性能计数器要可扩展

**服务网关要求升级票池服务，应该是在晚上，一半升级，一半继续服务的。**

**设置压力阀值，满足条件后自动创建新的票池服务器**

----

## 初始化 - 基础数据服务
----

**初始化车次信息**

1. 需要考虑一趟车一个车站停两次，[来源](http://12306ng.org/thread-1651-1-1.html)
2. 需要考虑一趟车两个起点和终点，[来源](http://12306ng.org/thread-1648-1-1.html)
3. 需要考虑一趟车在运行途中车次会变更，[来源](http://12306ng.org/thread-1648-1-1.html)
4. 需要考虑一趟车途中会拆分成两个车，因此一个车次在运行途中会有三个车次，[来源](http://12306ng.org/thread-1648-1-1.html)

**初始化车次座位信息，[来源](http://12306ng.org/thread-1244-1-1.html)**

**在运行时动态变更车辆配置**

**根据预售（12天）初始化服务器的车次信息**

1. 需要考虑一趟车两个起点和终点，[来源](http://12306ng.org/thread-1648-1-1.html)

**整个服务从虚机创建到部署完系统应该是全程自动化**

**车站所属的铁路局，这个信息用来支持管内共用车票这个需求，[来源](http://12306ng.org/thread-1192-1-1.html)**

----

## 买票
----

**服务网关向票池查询某始发站到终点站的所有车次以及每个车次的余票信息。**

1. 需要考虑一趟车一个车站停两次，[来源](http://12306ng.org/thread-1651-1-1.html)
2. 需要考虑一趟车两个起点和终点，[来源](http://12306ng.org/thread-1648-1-1.html)
3. 需要考虑一趟车在运行途中车次会变更，[来源](http://12306ng.org/thread-1648-1-1.html)
4. 需要考虑一趟车途中会拆分成两个车，因此一个车次在运行途中会有三个车次，[来源](http://12306ng.org/thread-1648-1-1.html)
5. 需要考虑同城多车站的查询购票问题，[来源](http://12306ng.org/thread-1574-1-1.html)

**服务网关向票池查询某车次的余票信息**

**服务网关向票池要求购买某车次的一到多张连续的票，订票请求的数量只要大于1，则默认就是要订购连续座位的车票。依次保证连续，或保证同车厢但不连续。[来源](http://12306ng.org/thread-1612-1-1.html)**

**服务网关向票池要求购买某车次的多张不连续的票，[来源](http://12306ng.org/thread-1612-1-1.html)**

**售票时，要支持鸳鸯卧铺的情况吗？[来源](http://12306ng.org/thread-1244-1-1.html)**

**售票时，要支持卧铺里，不能男女比例过于失衡的问题吗？[来源](http://12306ng.org/thread-1244-1-1.html)**

**售票时，要支持一些人性化的查询，比如老人就应该可以查有没有下铺买。[来源](http://12306ng.org/thread-1244-1-1.html)**

**订票加入人性化选项，[来源](http://12306ng.org/thread-1362-1-2.html)**

**可销售车票可能不允许卖短途区间。**

**每个可销售车票都具有特定的销售渠道限制。用于在实体窗口、电话、网络等不同渠道间分配可销售车票数量。**

**票池中的部分车票必须在指定时间后才可以进行销售。比如每天上午8点有新增的50张某车次的车票进行销售。**

**每个车票都具有销售预留类型，如学生票，伤残军人票，民工票等等。**

**车次或车票可以指定特定窗口进行销售。如有些国际线路的车次，只能在北京车站的某个售票窗口内出售。**

----

## 下订单 - 交易服务
----

**乘客买票尚未支付，需要将购买的票锁定，45分钟后如果没有得到订单系统的支付答复，自动解锁。**

**乘客买票后在支付前取消订单。**

**乘客买票且支付完毕。**

**退票**

1. 开车前退票
2. 开车后半小时内退票 - 应该是车上售票的情形了。

**改签**

1. 开车前改签其他车次
2. 开车后半小时内改签其他车次 - 应该是车上售票的情形了。
3. 坐车途中改签
4. 始发站到终点站本身就没有直达车，必须要中转的，这个在线下是可以卖的（车票上有始发和终点站，需要在中转站转车改签），这个需要支持吗？
5. 中间坐票改卧铺的
6. 始发站到终点站有直达车，但是乘客自己中途下了改签，不知道可不可以这样做？

**下订单时，票池应该将票的车次（可能有多个）、座位号、始发站、起始站等信息都提供给交易服务系统，因为票价计算有一些规则，这个规则还是由交易系统计算比较好，[来源](http://12306ng.org/thread-1231-1-1.html)**

----

## 业务网关服务
----

**支持预留票，可以预留车次任意预售期内的车票，可以预留车次任意始发到任意达到站的车票。[来源](http://12306ng.org/thread-1598-1-1.html)**

**支持计划票**

**计划票和预留票会复用**

**前方站可以使用后方站计划票额，反之则不可以。[来源](http://12306ng.org/thread-1192-1-1.html)**

**一次复用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**全程复用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**始发共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**管内共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**全程共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**车补全程复用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**车补全程复用、始发站共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**车补全程复用、管内共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**车补全程复用、全程共用，[来源](http://12306ng.org/thread-1192-1-1.html)**

**每车次在预售期内的可售票**

----

## QOS需求
----
**查询速度要非常快，能够满足一天5亿次级别的查询（够吗？）**
**查询始发站和终点站之间的车次的时间应该跟始发站和终点站的距离无关，具体来说查询速度不超过毫秒（还是纳秒）级别？**
